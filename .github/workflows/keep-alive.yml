name: Keep Supabase Alive

on:
  schedule:
    # Ejecutar cada 5 d√≠as a las 3:00 AM UTC
    # Formato: minuto hora d√≠a mes d√≠a-semana
    # */5 en d√≠as = cada 5 d√≠as
    - cron: '0 3 */5 * *'
  
  # Permite ejecutar manualmente desde GitHub Actions tab
  workflow_dispatch:

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Supabase Database
        run: |
          echo "üîÑ Haciendo ping a Supabase..."
          
          # Hacer request a la API REST de Supabase
          RESPONSE=$(curl -s -w "\n%{http_code}" \
            -X GET "${{ secrets.VITE_SUPABASE_URL }}/rest/v1/profesores?select=count" \
            -H "apikey: ${{ secrets.VITE_SUPABASE_ANON_KEY }}" \
            -H "Content-Type: application/json")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | head -n-1)
          
          echo "üìä Status Code: $HTTP_CODE"
          echo "üì¶ Response: $BODY"
          
          if [ "$HTTP_CODE" -eq 200 ] || [ "$HTTP_CODE" -eq 201 ]; then
            echo "‚úÖ Supabase est√° activo y respondiendo correctamente"
            exit 0
          else
            echo "‚ùå Error: Supabase respondi√≥ con c√≥digo $HTTP_CODE"
            exit 1
          fi
      
      - name: Log timestamp
        if: success()
        run: |
          echo "‚è∞ √öltimo ping exitoso: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "üéØ Pr√≥ximo ping programado: en 5 d√≠as"